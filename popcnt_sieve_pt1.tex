%
% File:   popcnt_sieve.qasm
% Date:   28-Nov-18
% Author: E. W. Postlethwaite
%
% Simple illustration of a circuit we might want to implement during quantum sieving
%
%     defbox  add4,4,0,'\texttt{add}'
% 
%     qubit   u0
%     qubit   a0,0
%     qubit   v0
%     qubit   v1
%     qubit   a1,0
%     qubit   u1
%     qubit   u2
%     qubit   a2,0
%     qubit   v2
%     qubit   v3
%     qubit   a3,0
%     qubit   u3
% 
%     cnot    u0,v0
%     cnot    u1,v1
%     cnot    u2,v2
%     cnot    u3,v3
% 
%     add4    a0,v0,v1,a1
%     add4    a2,v2,v3,a3

%  Time 01:
%    Gate 00 cnot(u0,v0)
%    Gate 01 cnot(u1,v1)
%    Gate 02 cnot(u2,v2)
%    Gate 03 cnot(u3,v3)
%  Time 02:
%    Gate 04 add4(a0,v0,v1,a1)
%    Gate 05 add4(a2,v2,v3,a3)

% Qubit circuit matrix:
%
% u0: gAxA, n  , n  
% a0: n  , gBxB, n  
% v0: gAxC, gBxC, n  
% v1: gAxD, gBxD, n  
% a1: n  , gBxE, n  
% u1: gAxF, n  , n  
% u2: gAxG, n  , n  
% a2: n  , gBxH, n  
% v2: gAxI, gBxI, n  
% v3: gAxJ, gBxJ, n  
% a3: n  , gBxK, n  
% u3: gAxL, n  , n  

\documentclass[11pt]{article}
\input{xyqcirc.tex}

% definitions for the circuit elements

\def\gAxA{\b\w\A{gAxA}}
\def\gAxC{\o\w\A{gAxC}}
\def\gAxF{\b\w\A{gAxF}}
\def\gAxD{\o\w\A{gAxD}}
\def\gAxG{\b\w\A{gAxG}}
\def\gAxI{\o\w\A{gAxI}}
\def\gAxL{\b\w\A{gAxL}}
\def\gAxJ{\o\w\A{gAxJ}}
\def\gBxB{\gnqubit{\texttt{add}}{ddd}\w\A{gBxB}}
\def\gBxC{\gspace{\texttt{add}}\w\A{gBxC}}
\def\gBxD{\gspace{\texttt{add}}\w\A{gBxD}}
\def\gBxE{\gspace{\texttt{add}}\w\A{gBxE}}
\def\gBxH{\gnqubit{\texttt{add}}{ddd}\w\A{gBxH}}
\def\gBxI{\gspace{\texttt{add}}\w\A{gBxI}}
\def\gBxJ{\gspace{\texttt{add}}\w\A{gBxJ}}
\def\gBxK{\gspace{\texttt{add}}\w\A{gBxK}}

% definitions for bit labels and initial states

\def\bA{ \q{u_{0}}}
\def\bB{\qv{a_{0}}{0}}
\def\bC{ \q{v_{0}}}
\def\bD{ \q{v_{1}}}
\def\bE{\qv{a_{1}}{0}}
\def\bF{ \q{u_{1}}}
\def\bG{ \q{u_{2}}}
\def\bH{\qv{a_{2}}{0}}
\def\bI{ \q{v_{2}}}
\def\bJ{ \q{v_{3}}}
\def\bK{\qv{a_{3}}{0}}
\def\bL{ \q{u_{3}}}

% The quantum circuit as an xymatrix

\xymatrix@R=5pt@C=10pt{
    \bA & \gAxA &\n   &\n  
\\  \bB & \n   &\gBxB &\n  
\\  \bC & \gAxC &\gBxC &\n  
\\  \bD & \gAxD &\gBxD &\n  
\\  \bE & \n   &\gBxE &\n  
\\  \bF & \gAxF &\n   &\n  
\\  \bG & \gAxG &\n   &\n  
\\  \bH & \n   &\gBxH &\n  
\\  \bI & \gAxI &\gBxI &\n  
\\  \bJ & \gAxJ &\gBxJ &\n  
\\  \bK & \n   &\gBxK &\n  
\\  \bL & \gAxL &\n   &\n  
%
% Vertical lines and other post-xymatrix latex
%
\ar@{-}"gAxC";"gAxA"
\ar@{-}"gAxD";"gAxF"
\ar@{-}"gAxI";"gAxG"
\ar@{-}"gAxJ";"gAxL"
}

\end{document}
